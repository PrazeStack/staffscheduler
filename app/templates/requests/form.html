{% extends "base.html" %}
{% block title %}{{ "Edit Request" if req else "New Request" }} - Staff Scheduler{% endblock %}

{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <h3 class="mb-3">{{ "Edit Request" if req else "New Request" }}</h3>

    <form method="post"
          action="{{ url_for('requests.update_request', request_id=req.id) if req else url_for('requests.create_request') }}">

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Unit</label>
          <select class="form-select" name="unit_id" required>
            <option value="" disabled {% if not req %}selected{% endif %}>Select unit</option>
            {% for u in unit_list %}
              <option value="{{ u.id }}" {% if req and req.unit_id == u.id %}selected{% endif %}>{{ u.unit_name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <label class="form-label">Coordinator name</label>
          <input class="form-control" name="coordinator_name" required value="{{ req.coordinator_name if req else '' }}">
        </div>

        <div class="col-md-4">
          <label class="form-label">Staff needed</label>
          <input class="form-control" type="number" min="1" name="staff_needed" required value="{{ req.staff_needed if req else '' }}">
        </div>

        {% set start_dt = req.start_datetime if req else None %}
        {% set end_dt = req.end_datetime if req else None %}

        <div class="col-md-4">
          <label class="form-label">Date</label>
          <input class="form-control" type="date" name="date" required value="{{ start_dt.strftime('%Y-%m-%d') if start_dt else '' }}">
        </div>

        <div class="col-md-2">
          <label class="form-label">Start</label>
          <input class="form-control" type="time" name="start_time" required value="{{ start_dt.strftime('%H:%M') if start_dt else '' }}">
        </div>

        <div class="col-md-2">
          <label class="form-label">End</label>
          <input class="form-control" type="time" name="end_time" required value="{{ end_dt.strftime('%H:%M') if end_dt else '' }}">
        </div>

        <div class="col-md-4">
          <label class="form-label">Status</label>
          <select class="form-select" name="status">
            {% for s in status_options %}
              <option value="{{ s }}" {% if req and req.status == s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
            {% if not req %}
              <option value="Open" selected>Open</option>
            {% endif %}
          </select>
        </div>

        <div class="col-md-12">
          <label class="form-label">Notes (optional)</label>
          <textarea class="form-control" name="notes" rows="3">{{ req.notes if req else '' }}</textarea>
        </div>
      </div>

      <div class="d-flex gap-2 mt-3">
        <button class="btn btn-primary">{{ "Save Changes" if req else "Create Request" }}</button>
        <a class="btn btn-outline-secondary" href="/requests/">Cancel</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}