{% extends "base.html" %}
{% block title %}{{ "Edit" if ra else "New" }} Recurring Assignment - Staff Scheduler{% endblock %}
{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <h3 class="mb-3">{{ "Edit" if ra else "New" }} Recurring Assignment</h3>

    <form method="post" action="{{ '/recurring-assignments/%d/edit'|format(ra.id) if ra else '/recurring-assignments/new' }}">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Staff</label>
          <select class="form-select" name="staff_id" required>
            <option value="" disabled {% if not ra %}selected{% endif %}>Select staff</option>
            {% for s in staff_list %}
              <option value="{{ s.id }}" {% if ra and ra.staff_id == s.id %}selected{% endif %}>{{ s.full_name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <label class="form-label">Unit</label>
          <select class="form-select" name="unit_id" required>
            <option value="" disabled {% if not ra %}selected{% endif %}>Select unit</option>
            {% for u in unit_list %}
              <option value="{{ u.id }}" {% if ra and ra.unit_id == u.id %}selected{% endif %}>{{ u.unit_name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label">Start time</label>
          <input class="form-control" type="time" name="start_time" required value="{{ ra.start_time if ra else '' }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">End time</label>
          <input class="form-control" type="time" name="end_time" required value="{{ ra.end_time if ra else '' }}">
        </div>

        <div class="col-md-6">
          <label class="form-label">Start date</label>
          <input class="form-control" type="date" name="start_date" required value="{{ ra.start_date.strftime('%Y-%m-%d') if ra else '' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">End date (blank = until changed)</label>
          <input class="form-control" type="date" name="end_date" value="{{ ra.end_date.strftime('%Y-%m-%d') if ra and ra.end_date else '' }}">
        </div>

        <div class="col-12">
          <label class="form-label">Days of week</label>
          <div class="d-flex flex-wrap gap-3">
            {% for code,label in [("MO","Mon"),("TU","Tue"),("WE","Wed"),("TH","Thu"),("FR","Fri"),("SA","Sat"),("SU","Sun")] %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="days" value="{{ code }}"
                       id="d{{ code }}" {% if code in selected_days %}checked{% endif %}>
                <label class="form-check-label" for="d{{ code }}">{{ label }}</label>
              </div>
            {% endfor %}
          </div>
        </div>

        <div class="col-12">
          <label class="form-label">Notes (optional)</label>
          <textarea class="form-control" name="notes" rows="3">{{ ra.notes if ra else '' }}</textarea>
        </div>

        {% if ra %}
        <div class="col-12">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if ra.is_active %}checked{% endif %}>
            <label class="form-check-label" for="is_active">Active</label>
          </div>
        </div>
        {% endif %}
      </div>

      <div class="d-flex gap-2 mt-3">
        <button class="btn btn-primary">{{ "Save" if ra else "Create" }}</button>
        <a class="btn btn-outline-secondary" href="/recurring-assignments/">Cancel</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}